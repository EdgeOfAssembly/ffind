<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ffind: benchmarks Directory Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ffind
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('dir_13a41d9ad64fb9ae396cb953294783cf.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">benchmarks Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-files" class="groupheader"><a id="files" name="files"></a>
Files</h2></td></tr>
<tr class="memitem:cache_5Fflush_2Ec" id="r_cache_5Fflush_2Ec"><td class="memItemLeft" align="right" valign="top"><span class="icondoc"><div class="doc-icon"></div></span>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__flush_8c.html">cache_flush.c</a></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<h1 class="doxsection"><a class="anchor" id="autotoc_md97"></a>
ffind Benchmarks</h1>
<p>This directory contains real-world benchmarking scripts for ffind performance testing.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md98"></a>
Quick Start</h1>
<div class="fragment"><div class="line"># 1. Set up test corpus</div>
<div class="line">cp -r /usr/src/linux-headers-* /tmp/test-corpus</div>
<div class="line"> </div>
<div class="line"># 2. Build ffind (from repository root)</div>
<div class="line">cd ..</div>
<div class="line">make</div>
<div class="line"> </div>
<div class="line"># 3. Build cache-flush utility</div>
<div class="line">cd benchmarks</div>
<div class="line">make</div>
<div class="line"> </div>
<div class="line"># 4. Run benchmarks (will prompt for sudo password for cache clearing)</div>
<div class="line">./run_real_benchmarks.sh</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md99"></a>
Test Corpus Setup</h1>
<p>The benchmark script expects a test corpus at <span class="tt">/tmp/test-corpus</span>. You have several options:</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md100"></a>
Option 1: Use Local Linux Headers (Recommended for Quick Testing)</h2>
<div class="fragment"><div class="line"># Copy existing Linux kernel headers (~130MB, ~16K files)</div>
<div class="line">cp -r /usr/src/linux-headers-* /tmp/test-corpus</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md101"></a>
Option 2: Download GCC Source Code (Network Required)</h2>
<p><b>For larger corpus (~790MB):</b> </p><div class="fragment"><div class="line">cd /tmp</div>
<div class="line">wget http://ftp.gnu.org/gnu/gcc/gcc-9.5.0/gcc-9.5.0.tar.xz</div>
<div class="line">tar -xf gcc-9.5.0.tar.xz</div>
<div class="line">mv gcc-9.5.0 test-corpus</div>
</div><!-- fragment --><p><b>For smaller corpus (~180MB):</b> </p><div class="fragment"><div class="line">cd /tmp</div>
<div class="line">wget http://ftp.gnu.org/gnu/gcc/gcc-3.4.6/gcc-3.4.6.tar.gz</div>
<div class="line">tar -xzf gcc-3.4.6.tar.gz</div>
<div class="line">mv gcc-3.4.6 test-corpus</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md102"></a>
Option 3: Download Linux Kernel (Network Required)</h2>
<div class="fragment"><div class="line">cd /tmp</div>
<div class="line">wget https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.10.1.tar.xz</div>
<div class="line">tar -xf linux-5.10.1.tar.xz</div>
<div class="line">mv linux-5.10.1 test-corpus</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md103"></a>
Option 4: Use Any Large Source Repository</h2>
<p>Any C/C++/Java project with 10,000+ files will work: </p><div class="fragment"><div class="line">cp -r ~/projects/large-codebase /tmp/test-corpus</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md104"></a>
Benchmark Script</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md105"></a>
What It Tests</h2>
<p>The <span class="tt">run_real_benchmarks.sh</span> script performs the following benchmarks:</p>
<ol type="1">
<li><b>File name searches</b> (<em>.c, *.h files)</em></li>
<li><em><b>File metadata searches</b> (files &gt;100KB)</em></li>
<li><em><b>Path pattern searches</b> (include/</em> directory)</li>
<li><b>Content searches</b> (fixed string: "static")</li>
<li><b>Regex content searches</b> ("EXPORT_SYMBOL|MODULE_")</li>
<li><b>File listing</b> (all files)</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md106"></a>
Methodology</h2>
<ul>
<li>Each benchmark runs <b>3 times</b>, median time reported</li>
<li>Compares against standard tools: <span class="tt">find</span>, <span class="tt">grep</span></li>
<li>Optionally tests against <span class="tt">ag</span> and <span class="tt">ripgrep</span> if available</li>
<li>All output redirected to <span class="tt">/dev/null</span> to measure pure execution time</li>
<li>Uses real filesystem (no artificial test data)</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md107"></a>
Output Format</h2>
<div class="fragment"><div class="line">=== Benchmark X: Description ===</div>
<div class="line">  find: 0.067s</div>
<div class="line">  ffind: 0.004s</div>
<div class="line">  Speedup: 15.9x faster</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md108"></a>
System Requirements</h1>
<ul>
<li>Linux (for inotify filesystem monitoring)</li>
<li>Bash shell</li>
<li>bc (basic calculator) for speedup calculations</li>
<li>At least 1GB free space in /tmp</li>
<li>GNU find and grep (standard on most Linux systems)</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md109"></a>
Performance Results</h1>
<p>Current benchmark results (Linux kernel headers, 16,548 files):</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Operation  </th><th class="markdownTableHeadNone">find/grep  </th><th class="markdownTableHeadNone">ffind  </th><th class="markdownTableHeadNone">Speedup  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Find *.c files  </td><td class="markdownTableBodyNone">0.067s  </td><td class="markdownTableBodyNone">0.004s  </td><td class="markdownTableBodyNone"><b>15.9x</b>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Find *.h files  </td><td class="markdownTableBodyNone">0.068s  </td><td class="markdownTableBodyNone">0.018s  </td><td class="markdownTableBodyNone"><b>3.8x</b>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Files &gt;100KB  </td><td class="markdownTableBodyNone">0.090s  </td><td class="markdownTableBodyNone">0.003s  </td><td class="markdownTableBodyNone"><b>28.4x</b>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">List all files  </td><td class="markdownTableBodyNone">0.063s  </td><td class="markdownTableBodyNone">0.025s  </td><td class="markdownTableBodyNone"><b>2.5x</b>  </td></tr>
</table>
<p><b>Note:</b> Content search performance is currently slower than grep, but file/metadata searches show significant speedups.</p>
<p>See main <a href="../README.md#performance-benchmarks">README.md</a> for complete benchmark results.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md110"></a>
Interpreting Results</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md111"></a>
What to Expect</h2>
<p><b>ffind should be faster for:</b></p><ul>
<li>File name searches (glob patterns)</li>
<li>File metadata queries (size, mtime, type)</li>
<li>Path-based searches</li>
<li>Repeated queries on the same dataset</li>
</ul>
<p><b>ffind may be slower for:</b></p><ul>
<li>Content searches (current implementation)</li>
<li>Single-use queries where index building overhead isn't amortized</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md112"></a>
Factors Affecting Performance</h2>
<ul>
<li><b>Corpus size:</b> Larger file trees show bigger speedups</li>
<li><b>Disk type:</b> SSD vs HDD affects initial indexing</li>
<li><b>Query type:</b> Indexed attributes (name, size) vs content search</li>
<li><b>System load:</b> Other processes competing for I/O</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md113"></a>
Customizing Benchmarks</h1>
<p>To test with different patterns or operations, edit <span class="tt">run_real_benchmarks.sh</span>:</p>
<div class="fragment"><div class="line"># Add a new benchmark</div>
<div class="line">echo &quot;=== Benchmark X: My custom test ===&quot;</div>
<div class="line">echo -n &quot;  find: &quot;</div>
<div class="line">FIND_TIME=$(run_benchmark &quot;description&quot; &quot;find &#39;$CORPUS_DIR&#39; -name &#39;pattern&#39;&quot;)</div>
<div class="line">echo &quot;${FIND_TIME}s&quot;</div>
<div class="line">echo -n &quot;  ffind: &quot;</div>
<div class="line">FFIND_TIME=$(run_benchmark &quot;description&quot; &quot;./ffind &#39;pattern&#39;&quot;)</div>
<div class="line">echo &quot;${FFIND_TIME}s&quot;</div>
<div class="line">SPEEDUP=$(echo &quot;scale=1; $FIND_TIME / $FFIND_TIME&quot; | bc)</div>
<div class="line">echo &quot;  Speedup: ${SPEEDUP}x faster&quot;</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md114"></a>
Troubleshooting</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md115"></a>
"Test corpus not found"</h2>
<div class="fragment"><div class="line"># Verify corpus exists</div>
<div class="line">ls -la /tmp/test-corpus</div>
<div class="line"># If not, set it up (see options above)</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md116"></a>
"ffind binaries not found"</h2>
<div class="fragment"><div class="line"># Build from repository root</div>
<div class="line">cd /home/runner/work/ffind/ffind  # adjust to your path</div>
<div class="line">make</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md117"></a>
Benchmark hangs or times out</h2>
<div class="fragment"><div class="line"># Kill any existing daemon</div>
<div class="line">ps aux | grep ffind-daemon</div>
<div class="line">kill &lt;PID&gt;</div>
<div class="line"> </div>
<div class="line"># Remove socket</div>
<div class="line">rm -f /run/user/$(id -u)/ffind.sock</div>
<div class="line"> </div>
<div class="line"># Try again</div>
<div class="line">./benchmarks/run_real_benchmarks.sh</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md118"></a>
Inconsistent results</h2>
<ul>
<li>Clear filesystem caches between runs using the cache-flush utility (see below)</li>
<li>Ensure no other heavy I/O processes are running</li>
<li>Run benchmarks multiple times and average results</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md119"></a>
Cache-Flush Utility</h1>
<p>The <span class="tt">cache-flush</span> C binary provides a secure, minimal utility for clearing Linux filesystem caches:</p>
<p><b>Build and Setup (one-time):</b> </p><div class="fragment"><div class="line"># Build the binary</div>
<div class="line">make</div>
</div><!-- fragment --><p><b>Usage:</b> </p><div class="fragment"><div class="line"># The benchmark script calls this automatically with sudo</div>
<div class="line"># For manual usage:</div>
<div class="line">sudo ./cache-flush</div>
</div><!-- fragment --><p><b>Security Model:</b></p><ul>
<li><b>Why sudo is required</b>: Linux requires elevated privileges to write to <span class="tt">/proc/sys/vm/drop_caches</span></li>
<li><b>Security benefit</b>: Only minimal auditable C code (~50 lines) runs with elevated privileges</li>
<li><b>Our approach</b>: Benchmark script calls sudo internally for cache-flush only</li>
</ul>
<p><b>Features:</b></p><ul>
<li><b>Security best practice</b>: Minimal C code (~50 lines) with elevated privileges</li>
<li><b>Explicit privilege control</b>: Requires sudo each time (no permanent capabilities)</li>
<li><b>Portable</b>: Simple C with no external dependencies</li>
<li><b>Easy to audit</b>: Small, focused code that's easy to security review</li>
</ul>
<p><b>Manual usage:</b> </p><div class="fragment"><div class="line"># Flush caches before a benchmark</div>
<div class="line">sudo ./cache-flush</div>
<div class="line">time find /usr -name &quot;*.so&quot;</div>
<div class="line"> </div>
<div class="line"># Compare warm vs cold cache</div>
<div class="line">time find /usr -name &quot;*.so&quot;  # Warm cache</div>
<div class="line">sudo ./cache-flush</div>
<div class="line">time find /usr -name &quot;*.so&quot;  # Cold cache</div>
</div><!-- fragment --><p><b>Technical details:</b></p><ul>
<li>Calls <span class="tt">sync()</span> to flush dirty pages to disk</li>
<li>Writes "3" to <span class="tt">/proc/sys/vm/drop_caches</span> to clear page cache, dentries, and inodes</li>
<li>Returns 0 on success, 1 on error</li>
</ul>
<p>The benchmark script (<span class="tt">run_real_benchmarks.sh</span>) automatically uses this utility with sudo when running benchmarks.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md120"></a>
Contributing</h1>
<p>Found a performance issue or have optimization suggestions? Please:</p><ol type="1">
<li>Run benchmarks with your changes</li>
<li>Include before/after results in PR description</li>
<li>Document test environment and corpus used</li>
</ol>
<h1 class="doxsection"><a class="anchor" id="autotoc_md121"></a>
License</h1>
<p>Same as main ffind project (GPL v3 / Commercial dual-license). </p>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_13a41d9ad64fb9ae396cb953294783cf.html">benchmarks</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
